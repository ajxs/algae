"use strict";var $_algae={htmlParser:new DOMParser()};$_algae.loadComponentTemplate=function(template){var container=document.createElement("div");var parsedTemplate=template.innerHTML.replace(/\n/g,'');parsedTemplate=parsedTemplate.replace(/>\s+|\s+</g,function(m){return m.trim();});var parsed=$_algae.htmlParser.parseFromString(parsedTemplate,"text/html").body;while(parsed.lastChild){container.prepend(parsed.removeChild(parsed.lastChild));}return container;};$_algae.loadComponent=function(componentTemplate,componentData){var templateInstance=$_algae.loadComponentTemplate(componentTemplate);$_algae.parseDomElement(templateInstance,componentData);return templateInstance;};
"use strict";var $_ALGAE_REGEX_VAR=/\#\!\$(.*)/;var $_ALGAE_REGEX_THIS=/\#\!\%/;var $_ALGAE_REGEX_EXPR=/\#\!\^\((.*)\)/;$_algae.parseAttributeString=function(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var componentData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var currentScope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:componentData;if(!text)return null;var test=$_ALGAE_REGEX_VAR.exec(text);if(test){return currentScope[test[1]]||null;}if($_ALGAE_REGEX_THIS.exec(text)){return currentScope;}test=$_ALGAE_REGEX_EXPR.exec(text);if(test){try{return new Function(["$self","$parent"],"return "+test[1])(currentScope,componentData);}catch(e){console.error(e);return null;}}return null;};$_algae.parseText=function(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var componentData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var currentScope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:componentData;var ret=text.replace($_ALGAE_REGEX_VAR,function(match,key){return currentScope[key]!=null?currentScope[key]:"";});ret=ret.replace($_ALGAE_REGEX_THIS,function(match,key){return currentScope||"";});ret=ret.replace($_ALGAE_REGEX_EXPR,function(match,key){try{return new Function(["$self","$parent"],"return "+key)(currentScope,componentData)||"";}catch(e){console.error(e);return null;}});return ret;};$_algae.parseDomElement=function(currentNode){var componentData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var currentScope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:componentData;var parentNode=currentNode.parentNode;if(currentNode.dataset.loopSource){var loopSourceArray=null;try{loopSourceArray=$_algae.parseAttributeString(currentNode.dataset.loopSource,componentData,currentScope);}catch(e){console.error(e);loopSourceArray=null;}if(!loopSourceArray){console.warn("loop-source iterable \""+currentNode.dataset.loopSource+"\" evaluates as 'null'.\nIgnoring.");loopSourceArray=[];}var loopContainer=document.createDocumentFragment();loopSourceArray.forEach(function(source){var newTemplateItem=currentNode.cloneNode(true);delete newTemplateItem.dataset.loopSource;loopContainer.appendChild(newTemplateItem);$_algae.parseDomElement(newTemplateItem,componentData,source);});parentNode.replaceChild(loopContainer,currentNode);return;}if(currentNode.dataset.displayCondition){try{if(!$_algae.parseAttributeString(currentNode.dataset.displayCondition,componentData,currentScope)){parentNode.removeChild(currentNode);return;}delete currentNode.dataset.displayCondition;}catch(e){console.error(e);return null;}}Array.from(currentNode.attributes).forEach(function(a){return a.value=$_algae.parseText(a.value,componentData,currentScope);});currentNode.firstChild.nodeValue=$_algae.parseText(currentNode.firstChild.nodeValue||"",componentData,currentScope);Array.from(currentNode.children).forEach(function(i){return $_algae.parseDomElement(i,componentData,currentScope);});};